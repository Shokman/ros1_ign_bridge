sudo: required

env:
  matrix:
    - DOCKER_IMAGE=ubuntu:18.04

services:
  - docker

language: c++

compiler:
  - gcc

before_install:
  - echo $DOCKER_IMAGE
  - docker pull $DOCKER_IMAGE
  - docker run -d -v $(pwd):/code $DOCKER_IMAGE /bin/bash -c 'while true; do sleep 1; done'
  - docker exec $(docker ps -aq) /bin/bash -c 'id'

before_script:
  - docker exec $(docker ps -aq) /bin/bash -c 'apt-get -qq update'
  - docker exec $(docker ps -aq) /bin/bash -c 'apt-get install -y --force-yes build-essential'

script:
  - docker exec $(docker ps -aq) /bin/bash -c ' \
      sh -c \'echo "deb http://packages.ros.org/ros/ubuntu bionic main" > /etc/apt/sources.list.d/ros-latest.list\' \
      wget http://packages.ros.org/ros.key -O - | sudo apt-key add - \
      apt-get update -qq \
      apt-get install -qq -y python-rosdep python-catkin-tools \
      rosdep init \
      rosdep update \
      rosdep install --from-paths ./ -i -y --rosdistro melodic \
      cd /code && ls \
    '
